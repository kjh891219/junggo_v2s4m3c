<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="creply">

  <insert id="reply" parameterType="CReplyVO">
    INSERT INTO creply (rno, rcomment, ctno, userid, nickname, passwd, wdate, grpno, indent, ansnum)
    VALUES((SELECT NVL(MAX(rno), 0) + 1 as rno FROM creply),
    #{rcomment}, #{ctno}, #{userid}, #{nickname}, #{passwd}, sysdate, #{grpno}, #{indent}, #{ansnum})
  </insert>

  <update id='updateAnsnum' parameterType="CReplyVO">
    UPDATE creply
    SET ansnum = ansnum + 1
    WHERE grpno = #{grpno} AND ansnum > #{ansnum}
  </update>

  <!-- 답변 1건 조회 -->
   <select id="read" resultType="CReplyVO" parameterType="int">
    SELECT rno, rcomment, ctno, userid, nickname, passwd, wdate, grpno, indent, ansnum
    FROM creply
    WHERE rno=#{rno}
  </select> 
</mapper>